(function () {
    "use strict";
    angular.module("common").factory("exportService",
      ["$http", "styleService",
        function ($http, styleService) {
            var self = {
                exportToExcel: exportToExcel,
            }

            return self;

            /* private method */

            function getCellClass(cellData) {
                if (angular.isFunction(cellData.cssClass)) {
                    return cellData.cssClass(cellData.row, cellData.column, cellData.value);
                }
                else {
                    return cellData.cssClass;
                }
            }

            function buildHtmlPageHeaderColumns(dataItem) {
                var htmlData = '';
                angular.forEach(dataItem.columns, function (column) {
                    htmlData = htmlData + '<td colspan="' + column.colspan + '" ';
                    if (angular.isDefined(column.cssClass)) {
                        htmlData = htmlData + ' class="' + column.cssClass + '"';
                    }
                    htmlData = htmlData + '>' + dataItem.row[column.field]
                    + '</td>';
                });
                return htmlData;
            }

            function buildHtmlPageHeader(data) {
                var htmlData = '';
                if (!angular.isDefined(data.pageHeaderDefs) && data.pageHeaderDefs.length < 1) {
                    return htmlData;
                }
                htmlData = '<table class="table">\r\n'

                var len = data.pageHeaderDefs.length;
                for (var i = 0; i < len; i++) {
                    var headerPageRow = data.pageHeaderDefs[i];
                    htmlData = htmlData + '<tr'
                    if (angular.isDefined(headerPageRow.cssClass)) {
                        htmlData = htmlData + ' class="' + headerPageRow.cssClass + '"';
                    }
                    htmlData = htmlData + '>';
                    htmlData = htmlData + buildHtmlPageHeaderColumns({ row: data.pageHeaderData, columns: headerPageRow.cells })
                    htmlData = htmlData + '</tr>\r\n';
                }

                //angular.forEach(data.pageHeaderDefs, function (headerPageRow) {
                //    htmlData = htmlData + '<tr'
                //    if (angular.isDefined(headerPageRow.cssClass)) {
                //        htmlData = htmlData + ' class="' + headerPageRow.cssClass + '"';
                //    }
                //    htmlData = htmlData + '>';
                //    htmlData = htmlData + buildHtmlPageHeaderColumns({ row: data.pageHeaderData, columns: headerPageRow.cells })
                //    htmlData = htmlData + '</tr>\r\n';
                //});
                htmlData = htmlData + '</table>';
                return htmlData;
            }

            function buildHtmlColGroup(columns) {
                var htmlData = '<colgroup>';
                angular.forEach(columns, function (colItem) {
                    htmlData = htmlData + '<col width="' + colItem.width + '"/>';
                });
                htmlData = htmlData + '</colgroup>\r\n';
                return htmlData;
            }

            function buildHtmlColGroupCategory(groupCategory) {
                var htmlData = '';
                if (angular.isDefined(groupCategory) && groupCategory.length > 0) {
                    htmlData = htmlData + '<tr>'
                    angular.forEach(groupCategory, function (gropuItem) {
                        htmlData = htmlData + '<th '
                        if (angular.isDefined(gropuItem.colspan)) {
                            htmlData = htmlData + ' colspan = "' + gropuItem.colspan + '"';
                        }
                        if (angular.isDefined(gropuItem.cssClass)) {
                            htmlData = htmlData + ' class = "' + gropuItem.cssClass + '"';
                        }
                        htmlData = htmlData + '>' + gropuItem.groupName + '</th>';
                    });
                    htmlData = htmlData + '</tr>\r\n';
                }
                return htmlData;
            }

            function buildHtmlTableDisplayColumns(columns) {
                var htmlData = '<tr>'
                angular.forEach(columns, function (colItem) {
                    htmlData = htmlData + '<th ';
                    if (angular.isDefined(colItem.cssClass)) {
                        htmlData = htmlData + ' class = "' + colItem.cssClass + '"';
                    }
                    htmlData = htmlData + '>' + colItem.displayName + '</th>';
                });
                htmlData = htmlData + '</tr>\r\n';
                return htmlData;
            }

            function buildHtmlTableDataColumns(dataItem) {
                var htmlData = '';
                angular.forEach(dataItem.columns, function (column) {
                    if (angular.isDefined(column.exportCellClass)) {
                        htmlData = htmlData + '<td class="' + column.exportCellClass(dataItem.row, column, dataItem.row[column.field]) + '" >'
                    }
                    else if (angular.isDefined(column.cellClass)) {
                        var cssValue = getCellClass({
                            cssClass: column.cellClass,
                            row: dataItem.row,
                            column: column,
                            value: dataItem.row[column.field]
                        });
                        htmlData = htmlData + '<td class="' + cssValue + '" >'
                    }
                    else {
                        htmlData = htmlData + '<td>'
                    }
                    htmlData = htmlData + dataItem.row[column.field] + '</td>';
                });
                return htmlData;
            }

            function buildHtmlTableDataRows(data) {
                var htmlData = '';
                angular.forEach(data.rows, function (row) {
                    htmlData = htmlData + '<tr>'
                             + buildHtmlTableDataColumns({ row: row, columns: data.columns })
                             + '</tr>\r\n';
                });
                return htmlData;
            }

            function buildHtmlTable(exportData) {
                var htmlData = '<div>'
                htmlData = htmlData + buildHtmlPageHeader({ pageHeaderDefs: exportData.options.pageHeaderDefs, pageHeaderData: exportData.options.data.pageHeader });
                htmlData = htmlData + '<table class="table">\r\n' + buildHtmlColGroup(exportData.options.columnDefs);
                htmlData = htmlData + buildHtmlColGroupCategory(exportData.groupCategory);
                htmlData = htmlData + buildHtmlTableDisplayColumns(exportData.options.columnDefs);
                htmlData = htmlData + buildHtmlTableDataRows({ rows: exportData.options.data.bindData, columns: exportData.options.columnDefs });
                htmlData = htmlData + '</table></div>';

                return htmlData;
            }

            /* public method */
            function exportToExcel(event, exportData) {
                var inlineStyleSheet = styleService.convertToInline(exportData.options.inlineExportStyle);
                var htmlData = inlineStyleSheet + '\r\n';

                if (angular.isDefined(exportData.htmlData) && exportData.htmlData !== null) {
                    var cleanExportData = String(exportData.htmlData)
                                .replace(/<!--(.*?)-->/gm, "")
                                .replace(/="ng-binding ng-scope/gm, "=\"")
                                .replace(/="ng-binding/gm, "=\"")
                                .replace(/="ng-scope/gm, "=\"")
                                .replace(/ng-.+?=".*?"/g, '')
                                .replace(/class=" /g, 'class="')
                                .replace(/class=""/g, '');

                    //.replace(/<!--(.*?)-->/gm, "")
                    //.replace(/="ng-binding ng-scope/gm, "=\"undefined")
                    //.replace(/="ng-binding/gm, "=\"undefined")
                    //.replace(/="ng-scope/gm, "=\"undefined")
                    //.replace(/ng-.+?=".*?"/g, '')
                    //.replace(/class="undefined /g, 'class="')
                    //.replace(/class="undefined"/g, '')
                    //.replace(/class=""/g, '');

                    //cleanExportData = '<div>\n    <div id=\"gstestReportExportId\" class=\"gsRptDefHeaderStyle\">\n        <table class=\"table\">\n            <thead>\n                <tr class=\"PageSubHead\">\n\n                    <td colspan=\"8\" class=\" PageSubHead\">\n                        Report Last retrieved on: 09 Dec-15 04:30:32 PM\n                    <\/td>\n                <\/tr>\n                <tr class=\"PageSubHead\">\n\n                    <td colspan=\"8\" class=\" PageSubHead\">\n                        Budget column represents PY Actuals\n                    <\/td>\n                <\/tr>\n                <tr class=\"PageSubHead\">\n\n                    <td colspan=\"8\" class=\" PageSubHead\">\n                        Greensheet Performance (Consolidated : Net Revenue : BAC Revenue Flow : All Regions)\n                    <\/td>\n                <\/tr>\n                <tr class=\"PageSubHead\">\n\n                    <td colspan=\"8\" class=\" PageSubHead\">\n                        Wed 18-Nov-15\n                    <\/td>\n                <\/tr>\n                <tr class=\"PageSubHead\">\n\n                    <td colspan=\"\" class=\" PageSubHead\">\n                        ($ in 000\'s)\n                    <\/td>\n                    <td colspan=\"7\" class=\" PageSubHead\">\n                        Note: * Week To Date displays Monday through Friday data.\n                    <\/td>\n                <\/tr>\n            <\/thead>\n            <tbody>\n            <\/tbody>\n        <\/table>\n    <\/div>\n    <div id=\"parent\" class=\"gsRptHeaderStyle\" style=\"overflow: auto;\">\n\n        <div id=\"fixTable\" class=\"gsRptTableStyle\">\n            <table id=\"gsReportExportTableId\" class=\"table \">\n                <colgroup>\n                    <col width=\"250px\">\n                        <col width=\"70px\">\n                            <col width=\"70px\">\n                                <col width=\"70px\">\n                                    <col width=\"70px\">\n                                        <col width=\"70px\">\n                                            <col width=\"70px\">\n                                                <col width=\"70px\">\n                                                    <col width=\"70px\">\n                                                        <col width=\"70px\">\n                                                            <col width=\"70px\">\n                <\/colgroup>\n                <thead>\n                    <tr class=\"colheading\">\n                        <th colspan=\"1\" class=\" PageSubHead\" style=\"position: relative; z-index: 1; top: 0px; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                        <\/th>\n                        <th colspan=\"6\" class=\" colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n\n                        <\/th>\n                        <th colspan=\"2\" class=\" colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                            Month-To-Date\n                        <\/th>\n                        <th colspan=\"2\" class=\" colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                            Quarter-To-Date\n                        <\/th>\n                    <\/tr>\n                    <tr class=\"colheading\">\n                        <th colspan=\"\" class=\"PageSubHead\" style=\"position: relative; z-index: 1; top: 0px; left: 0px; background-color: rgb(196, 224, 196);\">\n                            <span>columnDescription<\/span>\n                        <\/th>\n                        <th colspan=\"\" class=\"colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                            <span>16-Nov-15<\/span>\n                        <\/th>\n                        <th colspan=\"\" class=\"colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                            <span>17-Nov-15<\/span>\n                        <\/th>\n                        <th colspan=\"\" class=\"colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                            <span>wednesday<\/span>\n                        <\/th>\n                        <th colspan=\"\" class=\"colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                            <span>thursday<\/span>\n                        <\/th>\n                        <th colspan=\"\" class=\"colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                            <span>friday<\/span>\n                        <\/th>\n                        <th colspan=\"\" class=\"colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                            <span>wtdEst<\/span>\n                        <\/th>\n                        <th colspan=\"\" class=\"colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                            <span>monthToDateEst<\/span>\n                        <\/th>\n                        <th colspan=\"\" class=\"colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                            <span>monthToDateBud<\/span>\n                        <\/th>\n                        <th colspan=\"\" class=\"colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                            <span>quarterToDateActEst<\/span>\n                        <\/th>\n                        <th colspan=\"\" class=\"colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                            <span>quarterToDateBud<\/span>\n                        <\/th>\n                    <\/tr>\n                <\/thead>\n                <tbody>\n                    <tr >\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            GLOBAL RATES\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                    <tr diveder-row=\"dataRow\">\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            GLOBAL FINANCING &amp; FUTURES\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                    <tr diveder-row=\"dataRow\">\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            G10\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                    <tr diveder-row=\"dataRow\">\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            MUNICIPAL BANKING AND MARKETS\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td class="negative">\n\n                            522\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                    <tr >\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            MORTGAGE PRODUCTS\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td class=\"negative\">\n\n                            -1\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                    <tr diveder-row=\"dataRow\">\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            GLOBAL CREDIT AND SPECIAL SITUATIONS\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                    <tr diveder-row=\"dataRow\">\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            COUNTERPARTY PORTFOLIO MANAGEMENT\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                    <tr diveder-row=\"dataRow\">\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            FICC EMERGING MARKETS\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                    <tr diveder-row=\"dataRow\">\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            COMMODITIES\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                    <tr diveder-row=\"dataRow\">\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            FICC MANAGEMENT\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                    <tr diveder-row=\"dataRow\">\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            TOTAL FICC\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                    <tr class=\"BlankDivederRow\" diveder-row=\"dataRow\">\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            DividerRow\n                        <\/td>\n                        <td>\n\n\n                        <\/td>\n                        <td>\n\n\n                        <\/td>\n                        <td>\n\n\n                        <\/td>\n                        <td>\n\n\n                        <\/td>\n                        <td>\n\n\n                        <\/td>\n                        <td>\n\n\n                        <\/td>\n                        <td>\n\n\n                        <\/td>\n                        <td>\n\n\n                        <\/td>\n                        <td>\n\n\n                        <\/td>\n                        <td>\n\n\n                        <\/td>\n                    <\/tr>\n                    <tr diveder-row=\"dataRow\">\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            EQUITY EXECUTION SERVICES\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                    <tr diveder-row=\"dataRow\">\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            EQUITY CLIENT SOLUTIONS\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                    <tr diveder-row=\"dataRow\">\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            EQUITY ASSET MANAGEMENT SERVICES\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                    <tr diveder-row=\"dataRow\">\n                        <td class=\" colheading\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n\n                            EQUITIES MANAGEMENT\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                        <td>\n\n                            -\n                        <\/td>\n                    <\/tr>\n                <\/tbody>\n            <\/table>\n        <\/div>\n    <\/div>\n<\/div>';

                    //cleanExportData = '   <div id=\"gstestReportExportId\" class=\"gsRptDefHeaderStyle\">\n            <table class=\"table\">\n                <thead>\n                    <tr class=\"PageSubHead\" >\n                        \n                        <td colspan=\"8\"   class=\"PageSubHead\">\n                            Report Last retrieved on: 09 Dec-15 04:30:32 PM\n                        <\/td>\n                    <\/tr><tr class=\"PageSubHead\" >\n                        \n                        <td colspan=\"8\"   class=\"PageSubHead\">\n                            Budget column represents PY Actuals\n                        <\/td>\n                    <\/tr><tr class=\"PageSubHead\" >\n                        \n                        <td colspan=\"8\"   class=\"PageSubHead\">\n                            Greensheet Performance (Consolidated : Net Revenue : BAC Revenue Flow : All Regions)  \n                        <\/td>\n                    <\/tr><tr class=\"PageSubHead\" >\n                        \n                        <td colspan=\"8\"   class=\"PageSubHead\">\n                            Wed 18-Nov-15\n                        <\/td>\n                    <\/tr><tr class=\"PageSubHead\" >\n                        \n                        <td colspan=\"\"   class=\"PageSubHead\">\n                            ($ in 000\'s)\n                        <\/td><td colspan=\"7\"   class=\"PageSubHead\">\n                            Note: * Week To Date displays Monday through Friday data.\n                        <\/td>\n                    <\/tr>\n                <\/thead>\n                <tbody><\/tbody>\n            <\/table>\n        <\/div>\n        <div id=\"parent\" class=\"gsRptHeaderStyle\" style=\"overflow: auto;\">\n            \n        <div id=\"fixTable\" class=\"gsRptTableStyle\">\n                <table id=\"gsReportExportTableId\" class=\"table \">\n                    <colgroup>\n                        <col width=\"250px\"  ><col width=\"70px\"  ><col width=\"70px\"  ><col width=\"70px\"  ><col width=\"70px\"  ><col width=\"70px\"  ><col width=\"70px\"  ><col width=\"70px\"  ><col width=\"70px\"  ><col width=\"70px\"  ><col width=\"70px\"  >\n                    <\/colgroup>\n                    <thead>\n                        <tr class=\"colheading\">\n                            <th colspan=\"1\"   class=\"PageSubHead\" style=\"position: relative; z-index: 1; top: 0px; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                            <\/th><th colspan=\"6\"   class=\"colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                            <\/th><th colspan=\"2\"   class=\"colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                                Month-To-Date\n                            <\/th><th colspan=\"2\"   class=\"colheading\" style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                                Quarter-To-Date\n                            <\/th>\n                        <\/tr>\n                        <tr class=\"colheading\">\n                            <th colspan=\"\" class=\"PageSubHead\"  style=\"position: relative; z-index: 1; top: 0px; left: 0px; background-color: rgb(196, 224, 196);\">\n                                <span  ><\/span>\n                            <\/th><th colspan=\"\" class=\"colheading\"  style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                                <span  >16-Nov-15<\/span>\n                            <\/th><th colspan=\"\" class=\"colheading\"  style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                                <span  >17-Nov-15<\/span>\n                            <\/th><th colspan=\"\" class=\"colheading\"  style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                                <span  >wednesday<\/span>\n                            <\/th><th colspan=\"\" class=\"colheading\"  style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                                <span  >thursday<\/span>\n                            <\/th><th colspan=\"\" class=\"colheading\"  style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                                <span  >friday<\/span>\n                            <\/th><th colspan=\"\" class=\"colheading\"  style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                                <span  >wtdEst<\/span>\n                            <\/th><th colspan=\"\" class=\"colheading\"  style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                                <span  >monthToDateEst<\/span>\n                            <\/th><th colspan=\"\" class=\"colheading\"  style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                                <span  >monthToDateBud<\/span>\n                            <\/th><th colspan=\"\" class=\"colheading\"  style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                                <span  >quarterToDateActEst<\/span>\n                            <\/th><th colspan=\"\" class=\"colheading\"  style=\"position: relative; top: 0px; background-color: rgb(196, 224, 196);\">\n                                <span  >quarterToDateBud<\/span>\n                            <\/th>\n                        <\/tr>\n                    <\/thead>\n                    <tbody>\n                        <tr  >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                GLOBAL RATES\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr><tr  >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                GLOBAL FINANCING &amp; FUTURES\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr><tr  >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                G10\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr><tr  >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                MUNICIPAL BANKING AND MARKETS\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                522\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr><tr  >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                MORTGAGE PRODUCTS\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"negative\">\n                                \n                                -1\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr><tr  >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                GLOBAL CREDIT AND SPECIAL SITUATIONS\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr><tr  >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                COUNTERPARTY PORTFOLIO MANAGEMENT\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr><tr  >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                FICC EMERGING MARKETS\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr><tr  >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                COMMODITIES\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr><tr  >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                FICC MANAGEMENT\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr><tr class=\"border_top\" >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                TOTAL FICC\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr><tr class=\"BlankDivederRow\" >\n                            <td    style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                \n                            <\/td><td   >\n                                \n                                \n                            <\/td><td   >\n                                \n                                \n                            <\/td><td   >\n                                \n                                \n                            <\/td><td   >\n                                \n                                \n                            <\/td><td   >\n                                \n                                \n                            <\/td><td   >\n                                \n                                \n                            <\/td><td   >\n                                \n                                \n                            <\/td><td   >\n                                \n                                \n                            <\/td><td   >\n                                \n                                \n                            <\/td><td   >\n                                \n                                \n                            <\/td>\n                        <\/tr><tr  >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                 EQUITY EXECUTION SERVICES\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr><tr  >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                EQUITY CLIENT SOLUTIONS\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr><tr  >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                EQUITY ASSET MANAGEMENT SERVICES\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr><tr  >\n                            <td   class=\"colheading datacell\" style=\"position: relative; left: 0px; background-color: rgb(196, 224, 196);\">\n                                \n                                 EQUITIES MANAGEMENT\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td><td   class=\"datacell\">\n                                \n                                -\n                            <\/td>\n                        <\/tr>\n                    <\/tbody>\n                <\/table>\n            <\/div><\/div>';

                    htmlData = htmlData + cleanExportData;
                }
                else {
                    htmlData = htmlData + buildHtmlTable(exportData);
                    //var myVariable = '<div><table class=\"table\">\n<tr class=\"PageSubHead\"><td colspan=\"8\"  class=\"PageSubHead\">Report Last retrieved on: 09 Dec-15 04:30:32 PM<\/td><\/tr>\n<tr class=\"PageSubHead\"><td colspan=\"8\"  class=\"PageSubHead\">Budget column represents PY Actuals<\/td><\/tr>\n<tr class=\"PageSubHead\"><td colspan=\"8\"  class=\"PageSubHead\">Greensheet Performance (Consolidated : Net Revenue : BAC Revenue Flow : All Regions)  <\/td><\/tr>\n<tr class=\"PageSubHead\"><td colspan=\"8\"  class=\"PageSubHead\">Wed 18-Nov-15<\/td><\/tr>\n<tr class=\"PageSubHead\"><td colspan=\"undefined\"  class=\"PageSubHead\">($ in 000\'s)<\/td><td colspan=\"7\"  class=\"PageSubHead\">Note: * Week To Date displays Monday through Friday data.<\/td><\/tr>\n<\/table><table class=\"table\">\n<colgroup><col width=\"250\"\/><col width=\"70\"\/><col width=\"70\"\/><col width=\"70\"\/><col width=\"70\"\/><col width=\"70\"\/><col width=\"70\"\/><col width=\"70\"\/><col width=\"70\"\/><col width=\"70\"\/><col width=\"70\"\/><\/colgroup>\n<tr><th  colspan = \"1\" class = \"PageSubHead\"><\/th><th  colspan = \"6\" class = \"colheading\"><\/th><th  colspan = \"2\" class = \"colheading\">Month-To-Date<\/th><th  colspan = \"2\" class = \"colheading\">Quarter-To-Date<\/th><\/tr>\n<tr><th  class = \"PageSubHead\">columnDescription<\/th><th  class = \"colheading\">16-Nov-15<\/th><th  class = \"colheading\">17-Nov-15<\/th><th  class = \"colheading\">wednesday<\/th><th  class = \"colheading\">thursday<\/th><th  class = \"colheading\">friday<\/th><th  class = \"colheading\">wtdEst<\/th><th  class = \"colheading\">monthToDateEst<\/th><th  class = \"colheading\">monthToDateBud<\/th><th  class = \"colheading\">quarterToDateActEst<\/th><th  class = \"colheading\">quarterToDateBud<\/th><\/tr>\n<tr><td class=\"colheading\" >GLOBAL RATES<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"undefined\" >-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<tr><td class=\"colheading\" >GLOBAL FINANCING & FUTURES<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"undefined\" >-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<tr><td class=\"colheading\" >G10<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"undefined\" >-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<tr><td class=\"colheading\" >MUNICIPAL BANKING AND MARKETS<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"negative\" >522<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<tr><td class=\"colheading\" >MORTGAGE PRODUCTS<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"negative\" >-1<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<tr><td class=\"colheading\" >GLOBAL CREDIT AND SPECIAL SITUATIONS<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"undefined\" >-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<tr><td class=\"colheading\" >COUNTERPARTY PORTFOLIO MANAGEMENT<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"undefined\" >-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<tr><td class=\"colheading\" >FICC EMERGING MARKETS<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"undefined\" >-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<tr><td class=\"colheading\" >COMMODITIES<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"undefined\" >-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<tr><td class=\"colheading\" >FICC MANAGEMENT<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"undefined\" >-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<tr><td class=\"colheading\" >TOTAL FICC<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"undefined\" >-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<tr><td class=\"colheading\" >DividerRow<\/td><td><\/td><td><\/td><td><\/td><td><\/td><td class=\"undefined\" ><\/td><td><\/td><td><\/td><td><\/td><td><\/td><td><\/td><\/tr>\n<tr><td class=\"colheading\" > EQUITY EXECUTION SERVICES<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"undefined\" >-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<tr><td class=\"colheading\" >EQUITY CLIENT SOLUTIONS<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"undefined\" >-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<tr><td class=\"colheading\" >EQUITY ASSET MANAGEMENT SERVICES<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"undefined\" >-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<tr><td class=\"colheading\" > EQUITIES MANAGEMENT<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td class=\"undefined\" >-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><td>-<\/td><\/tr>\n<\/table><\/div>';
                    //htmlData = htmlData + myVariable;
                }


                var uri = { excel: 'data:application/vnd.ms-excel;base64,', csv: 'data:application/csv;base64,' };
                var template = { excel: '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>' };

                var base64 = function (s) {
                    return window.btoa(window.unescape(encodeURIComponent(s)));
                };
                var format = function (s, c) {
                    return s.replace(new RegExp("{(\\w+)}", "g"), function (m, p) {
                        return c[p];
                    });
                };

                var ctx = { worksheet: name || 'Worksheet', table: htmlData };
                var hrefvalue = uri.excel + base64(format(template.excel, ctx));

                var ua = window.navigator.userAgent;
                var msie = ua.indexOf("MSIE ");
                if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))      // If Internet Explorer
                {
                    window.open('data:application/vnd.xls,' + base64(format(template.excel, ctx)));
                    event.preventDefault();
                }
                else {
                    var element = angular.element("<a/>");
                    element.attr({
                        href: hrefvalue,
                        //target: "_blank",
                        //download: "test.xlsx"
                    })[0].click();
                    element.remove();
                }
            }
        }]);
}());
